{% extends 'pubswh/base.html' %}
{% block head %}
    <title>{{ pubdata['title'] }}</title>
    <meta NAME="title" content="{{ pubdata['title'] }}" />
    <meta name="description" content="{% if pubdata['docAbstract']  %}{{ pubdata['docAbstract'].split(' ')[0:150]|join(' ')|striptags }}...{% endif %}" />
    <META NAME="abstract" CONTENT="{% if pubdata['docAbstract']  %}{{ pubdata['docAbstract']|striptags }}{% endif %}" />
    {% for author in pubdata['authorsList'] %}<meta NAME="author" content="{{ author }}"/>{% endfor %}
    <meta name = "revised" content="{{ pubdata['lastModifiedDate'] }}"/>
    <meta name = "created" content="{{ pubdata['displayToPublicDate'] }}"/>
    <meta name = "date" content="{{ pubdata['publicationYear'] }}"/>
  <!-- meta tags for google scholar indexing and zotero/mendeley parsing -->
    <meta name="citation_title" content="{{ pubdata['title'] }}" />
    <meta name="citation_publication_date" content="{{ pubdata['publicationYear'] }}" />
    <meta name="citation_date" content="{{ pubdata['publicationYear'] }}" />
    <meta name="citation_online_date" content="{{ pubdata['displayToPublicDate'] }}" />
    {% for author in pubdata['authorsList'] %}<meta NAME="citation_author" content="{{ author }}"/>{% endfor %}
    {% if pubdata['abstract'] %}<meta name="citation_abstract" content="{{ pubdata['abstract']|striptags }}" />{% endif %}
    {% if pubdata['displayLinks']['document']|length > 0  %}<meta name="citation_pdf_url" content="{{ pubdata['displayLinks']['document'][0] }}" />{% endif %}
    {% if pubdata['conferenceTitle'] %}<meta name="citation_conference_title" content="{{ pubdata['conferenceTitle'] }}" />{% endif %}
    {% if pubdata['seriesTitle'] %}<meta name="citation_journal_title" content="{{ pubdata['seriesTitle']['text'] }}" />{% endif %}
    {% if pubdata['volume'] %}<meta name="citation_volume" content="{{ pubdata['volume'] }}" />{% endif %}
    {% if pubdata['issue'] %}<meta name="citation_issue" content="{{ pubdata['issue'] }}" />{% endif %}
    {% if pubdata['seriesTitle']%}<meta name="citation_issn" content="{{ pubdata['seriesTitle']['onlineIssn'] }}" />{% endif %}
    {% if pubdata['isbn'] %}<meta name="citation_isbn" content="{{ pubdata['isbn'] }}" />{% endif %}
    {% if pubdata['startPage'] %}<meta name="citation_firstpage" content="{{ pubdata['startPage'] }}" />{% endif %}
    {% if pubdata['endPage'] %}<meta name="citation_lastpage" content="{{ pubdata['endPage'] }}" />{% endif %}
    {% if pubdata['publicationType'] %}
        {% if pubdata['publicationType']['text'] == 'Thesis' %}<meta name="citation_dissertation_institution" content="{{ pubdata['publisher'] }}" />{% endif %}
        {% if pubdata['publicationType']['text'] == 'Report' %}<meta name="citation_technical_report_institution" content="{{ pubdata['publisher'] }}" />{% endif %}
        {% if pubdata['publicationType']['text'] == 'Report' %}<meta name="citation_technical_report_number" content="{{ pubdata['seriesNumber'] }}{% if pubdata['chapter'] %}-{{ pubdata['chapter'] }}{% endif %}" />{% endif %}
    {% endif %}
    {% if pubdata['doi'] %}<meta name="citation_doi" content="{{ pubdata['doi'] }}" />{% endif %}
    {% if pubdata['displayLinks']['Document']|length >= 1 %}
        <meta name="citation_pdf_url" content="{{ pubdata['displayLinks']['Document'][0]['url'] }}" />
    {% endif %}

    {% block page_style %}
       {%- if pubdata["geographicExtents"] -%}
        <link rel="stylesheet" href="{{ url_for('bower.static', filename = 'leaflet/dist/leaflet.css') }}">
       {% endif %}
    {% endblock page_style %}
    {% include 'pubswh/mathjax.html' %}

{% endblock head %}
        {% block main %}
        <main role ="main">
            <article itemscope itemtype="http://schema.org/ScholarlyArticle">
            {% if pubdata['publicationType']['text'] == 'Article' or pubdata['publicationType']['text'] == 'Report' %}<abbr class="unapi-id" title="http://pubs.er.usgs.gov/publication/{{ pubdata['indexId'] }}"><!-- avoid empty --></abbr>{% endif %}


                {# Choose publication title information to be displayed #}
                <hgroup class="publicationTitle">
                    <h1>Public access data</h1>
                    <h2>Data to facilitate access to author manuscripts</h2>
                    {% if pubdata['displayTitle'] %}
                    <h3 itemprop="name">{{ pubdata['displayTitle']|safe }}</h3>
                    {% else %}
                    <h3 itemprop="name">{{ pubdata['title']|safe }}</h3>
                    {% endif %}
                    {% if pubdata['seriesTitle'] %}
                    <h4>{{ pubdata['seriesTitle']['text'] }} {{ pubdata['seriesNumber'] }}{% if pubdata['chapter'] %}-{{ pubdata['chapter'] }}{% endif %}{% if pubdata['subChapter'] %}-{{ pubdata['subChapter'] }}{% endif %}</h4>
                    {% endif %}
                    {% if pubdata['subSeriesTitle'] %}
                    <h5>{{ pubdata['subSeriesTitle'] }}</h5>
                    {% endif %}
                    {% if pubdata['collaboration'] %}
                    <h6>{{ pubdata['collaboration']|safe }}</h6>
                    {% endif %}
                </hgroup>

                {# macro for generating the contributor lists, including commas & ands where they are supposed to be  #}
                {% macro contributor_list(contributorListTyped, contributorKind) %}
                    {%- for contributor in pubdata[contributorListTyped]  -%}
                          {% if loop.length == 2 and loop.first != True %} and {% elif loop.last and loop.length > 2 %}and {% endif %}
                          {%- if contributor['type'] == "person"  -%}
                            <span itemprop="{{ contributorKind }}" itemtype="http://schema.org/Person">{{ contributor['text'] }}</span>
                              {% if contributor['orcid'] %}
                                  <a href="{{ contributor['orcid'] }}">
                                    <img alt="ORCID iD" src="{{ url_for('pubswh.static', filename = 'img/orcid_16x16.png') }}" style="width:16px; height:16px; margin-right:4px; margin-left:4px">
                                  </a>
                              {% endif %}
                          {%- else -%}
                         <span itemprop="{{ contributorKind }}" itemtype="http://schema.org/Organization">{{ contributor['text'] }}</span>
                          {%- endif -%}
                          {% if not loop.last and loop.length > 2 %},
                          {% endif %}
                    {%-  endfor -%}
                {% endmacro %}

                <section>
                    <dl id="contributors">
                      {% if pubdata['authorsList'] %}
                      <dt>By:</dt>
                        <dd>
                            {{ contributor_list('authorsListTyped','author') }}
                        </dd>
                      {% endif %}
                      {% if pubdata['editorsList'] %}
                      <dt>Edited by:</dt>
                      <dd>
                         {{ contributor_list('editorsListTyped','editor') }}
                      </dd>
                      {%- endif -%}
                    {% if pubdata['compilersList'] %}
                      <dt>Compiled by:</dt>
                      <dd>
                         {{ contributor_list('compilersListTyped','compiler') }}
                      </dd>
                      {%- endif -%}
                    </dl>
                </section>

                <section>
                    {% if pubdata['noUsgsAuthors'] %}
                        <p>This publication was funded by extramural grants, and has no U.S. Geological Survey(USGS) affiliated authors or editors.
                        Hence, it was not required to conform to the USGS Fundamental Science Practices as described in the
                            <a title="Link to USGS Manual" href="https://www.usgs.gov/usgs-manual/">USGS Manual</a>.</p>
                    {% endif %}
                </section>

                <section>
                    <h4>IP Number: {{ pubdata['ipdsId'] }}</h4>
                </section>
                <section id="details">
                    <h4 id="" class="dark">Additional publication details</h4>
                    <dl id="publication_details">
                      {% for detail in pubdata['details'] %}
                          <dt class="{{ loop.cycle('', 'dark') }}">{{ detail.keys()[0] }}</dt>
                          <dd class="{{ loop.cycle('', 'dark') }}">{{ detail.values()[0]|safe }}</dd>
                      {% endfor %}
                    </dl>
                </section>
                 {% if pubdata['displayLinks']['Document'] or pubdata['displayLinks']['Plate'] or pubdata['displayLinks']['Sheet'] %}
                <aside>
                <small><p class="adobeReader">Part or all of this report is presented in Portable Document Format (PDF). For best results viewing and printing PDF documents, it is recommended that you download the documents to your computer and open them with Adobe Reader. PDF documents opened from your browser may not display or print as intended. Download the latest version of <a href="http://get.adobe.com/reader/">Adobe Reader</a>, free of charge. More information about viewing, downloading, and printing report files can be found <a href="http://pubs.usgs.gov/potential_problems.html">here</a>.</p></small>
                </aside>
            {% endif %}
            {% if pubdata['hasExcel'] == True  %}
                <aside>
                    <small><p class="adobeReader">Part of this report is presented in Microsoft Excel format (XLSX); the latest version of Excel Viewer is required to view it. Download the latest version of <a href="http://www.microsoft.com/en-us/download/details.aspx?id=10">Excel Viewer</a>, free of charge.</p> </small>
                </aside>
            {% endif %}
            </article>
        </main>
        {% endblock %}

        {% block url %}<a href="{{ url_for('pubswh.publication', index_id = pubdata['indexId']) }}">http://pubs.er.usgs.gov{{ url_for('pubswh.publication', index_id = pubdata['indexId']) }}</a>
            {% if current_user.is_authenticated %}
                <small>
                    <a href="{{ url_for('manager.show_app')}}#publication/{{ pubdata['id'] }}" target="_blank">(edit in Manager)</a>
                    <a href="{{ url_for('pubswh.clear_cache', path = request.path[1:], **request.args) }}">clear cache</a>
                </small>
            {% endif %}
        {% endblock %}

        {% block modtime %}{{ pubdata['formattedModifiedDateTime'] }}{% endblock %}

        {% block page_footer_script %}
        	{%- if pubdata["geographicExtents"] -%}
				<script type="text/javascript" src="{{ url_for('bower.static', filename='leaflet/dist/leaflet.js') }}"></script>
				<script type="text/javascript" src="{{ url_for('bower.static', filename='esri-leaflet/dist/esri-leaflet.js') }}"></script>
				<script type="text/javascript" src="{{ url_for('pubswh.static', filename='js/resultsMap.js') }}"></script>

				<script type="application/javascript">
					PUBS_WH.createResultsMap({
						mapDivId: 'mymap',
						publications: [{{ pubdata | tojson | safe }}],
						enablePopup: false
					});
				</script>
			{% endif %}
        {% endblock page_footer_script %}